<!DOCTYPE html>

<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>服务器</title>

    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">

    <!-- Bootstrap core CSS -->
     <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/highlight.js/9.11.0/styles/xcode.min.css">

    <!-- Custom styles for this template -->
    <!-- <link rel="stylesheet" href="./index_files/style.css"> -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        .mkfont {
          font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
          font-size: 16px;
          line-height:25px;
          color: #333;
          background-color: #fff;
        }
    }
    </style>
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0b0b03911bf3e050f9177fccd1e24775";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>

<body>

    <nav class="navbar navbar-inverse navbar-fixed-top site-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">H2ENGINE</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    </li>
                    <li><a href="intro.html">Intro</a>
                    </li>
                    <li><a href="tutorial.html">TUTORIAL</a>
                    </li>
                    <li><a href="docs.html">DOCS</a>
                    </li>
                    <li><a href="download.html">DOWNLOAD</a>
                    </li>
                    <li><a href="faq.html">FAQ</a>
                    </li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </nav>
    
    <div class="container" style="margin-top:100px;">
        <div class="row">
            <textarea id="text-input" name="text-input" style="display:none;">
# H2Engine 脚本化设计 
　　H2Engine脚本化设计的思路是：c++做数据结构和接口，脚本无状态处理逻辑。采用这种设计由如下几个原因。

## c++做数据结构缓存数据
　　游戏服务器一般都会使用比较多的内存，处于对接口相应速度的要求，服务器一般会缓存非常多的数据，如果使用脚本缓存数据，事实上脚本也是可以缓存数据的，但是当超过1G内存后，脚本的内存管理会非常的受限制，一般而言脚本都会有大内存的限制，超过阈值甚至是普通的内存分配都会失败比如lua。另外脚本因为大多都要对象引用计数和垃圾回收，如果脚本中出现循环引用导致内存泄漏，说实话，比c++的内存泄漏难查多了。所以in fact,c++中缓存数据是最科学的，这就是c++做数据结构的原因。

## C++可以实现某些接口直接操作数据  
　　c++做数据结构保留开发者用c++实现逻辑的能力，我们知道有些少数接口是对效率要求非常高，同时调用频率又非常大，这种接口非常适合用c++实现，比如走路这种。加入用脚本缓存数据，那么你c++再去访问脚本就非常的难做。

## 脚本接口一次编写，人人可用
　　因为c++编写数据结构和接口，比如某开发者开发了好用的一个功能模块比如成就系统，那么这个c++部分共享出来是每个项目都可以用的，但是脚本部分就不能通用了，因为两个项目可能用的脚本语言不一样，H2Engine很好的解决了这个问题，H2Engine提供了一个Scirpt注册的工具一统各个脚本的函数扩展，示例如下：
> ```cpp
static userid_t Entity_getUid(EntityPtr p){
    if (p){
        return p->getUid();
    }
    return 0;
}
static size_t Entity_totalNum(){
    return Entity::EntityPtr2Ref.size();
}
//!这里演示的是如何注册脚本接口
SCRIPT_UTIL.reg("Entity.getUid", Entity_getUid);
SCRIPT_UTIL.reg("Entity.totalNum", Entity_totalNum);
```

　　当SCRIPT_UTIL用注册接口后，无论你使用什么脚本语言，都可以在脚本中调用此函数，比如在lua中
> ```lua
numEntity = h2ext.callFunc('Entity.totalNum')
```

　　python中调用
> ```python
import h2ext
numEntity = h2ext.callFunc('Entity.totalNum')
```

　　几乎是统一的调用方式，真真正正是一次编写，人人可用，这个设计的初衷是为了给H2Engine提供一个好的模块分享的生态，必须保证开发者开发的模块，无缝的可以应用到其他项目中，一旦有门槛或限制，出于大部分开发者的尿性都会觉得还不如自己重写。所以这个特性是非常的有价值。需要注明一点，SCRIPT_UTIL注册的函数最多支持9个参数，基本数据类型以及stl的常用数据结构已经做了模板泛化，方便了开发者使用。


                </textarea>
            <div id="markdown-preview" class="mkfont"> </div>
            
            
        </div>
    </div>

    ﻿<!-- Site footer
    
    <div id="footer" class="container" style="margin-top:50px">
        <nav class="navbar navbar-default navbar-fixed-bottom">
            <div class="navbar-inner navbar-content-center">
                <p class="text-muted credit" style="padding: 0px;">
                    <p class="text-center"><a href="http://www.miibeian.gov.cn/" target="_blank">沪ICP备17021230号-1</a></p>
                    
                </p>
            </div>
        </nav>
    </div>
  -->
    <div id="container">
        <div id="footer">
            <p class="text-muted credit text-center">
                <a  target="_blank">沪ICP备17021230号-1</a>
            </p>
        </div>
    </div>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->

    <script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://cdn.bootcss.com/markdown.js/0.4.0/markdown.min.js"></script>
    <script src="http://cdn.bootcss.com/highlight.js/8.4/highlight.min.js"></script>
    <script>

      function Editor(input, preview) {
        this.update = function () {
            var strdata = input.value;
            if (strdata == "")
                strdata = " ";
            var a = strdata.substr(strdata.length-1, 1);
            while (a == '\n' || a == ' ' || a == '\r'){
                strdata = strdata.substr(0, strdata.length-1);
                if (strdata.length == 0)
                    break;
                a = strdata.substr(strdata.length-1, 1);
            }
            //alert(strdata+"a");
            var index = -1; //定义变量index控制索引值
            //当查找不到a，即indexOf()的值为-1时，结束循环
            var linenum = 0;
            do {
                index = strdata.indexOf("\n\n", index + 1); //使用第二个参数index+1，控制每一次查找都是从上一次查找到字符a的下一个索引位置开始
                if (index != -1) { //可以找到字符i
                    linenum += 1;
                }
            } while (index != -1);
            console.log('linenum:'+linenum);
            var genhtml = markdown.toHTML(strdata);
            
            genhtml = genhtml.replace(/<code>cpp/g, '<pre><code class="cpp">');
            genhtml = genhtml.replace(/<code>python/g, '<pre><code class="python">');
            genhtml = genhtml.replace(/<code>lua/g, '<pre><code class="lua">');
            genhtml = genhtml.replace(/<code>php/g, '<pre><code class="php">');
            genhtml = genhtml.replace(/<code>javascript/g, '<pre><code class="javascript">');
            genhtml = genhtml.replace(/code>/g, 'code></pre>');
            //
            if (linenum < 10){
                var needpx = (10 - linenum) * 80;
                genhtml += '<p style="margin-top:'+needpx+'px;"> </p>';
            }
            //alert(genhtml);
            
            preview.innerHTML = genhtml;
        };
        input.editor = this;
        this.update();
        
        //!highlight.min.js
        hljs.initHighlightingOnLoad();
        
      }
      var GetEByEd = function (id) { return document.getElementById(id); };

      new Editor(GetEByEd("text-input"), GetEByEd("markdown-preview"));
      
      //$(document).ready(function() {
      //    $('pre code').each(function(i, block) {
      //      hljs.highlightBlock(block);
      //    });
      //  });
    </script>
</body></html>

